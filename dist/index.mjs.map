{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import axios from 'axios';\nimport sharp from 'sharp';\nimport cheerio from 'cheerio';\nimport createImage from 'node-html-to-image';\n\nexport async function convertHtmlToImage(content: string, src: string) {\n  const parse = cheerio.load(content);\n  const imgTags = parse('img');\n\n  await Promise.all(\n    imgTags.map(async (index, element) => {\n      const imgElement = parse(element);\n      const imgUrl = imgElement.attr('src');\n\n      if (imgUrl) {\n        try {\n          // Скачиваем изображение\n          const response = await axios.get(imgUrl, {\n            responseType: 'arraybuffer',\n          });\n\n          // Изменяем размер изображения с помощью sharp\n          const resizedImageBuffer = await sharp(response.data)\n            .resize({ width: 600, height: 600, fit: 'inside' }) // Можно также задать ширину или другие параметры\n            .jpeg({ quality: 70 })\n            .toBuffer();\n\n          // Конвертируем изображение в base64\n\n          // @ts-ignore\n          const base64Image = `data:image/${sharp(response.data).metadata().format};base64,${resizedImageBuffer.toString('base64')}`;\n\n          // Заменяем src в теге <img> на base64 строку\n          imgElement.attr('src', base64Image);\n        } catch (error) {\n          console.error(`Error processing image ${imgUrl}: ${error}`);\n        }\n      }\n    }),\n  );\n  const update = parse.html();\n  await createImage({\n    output: src,\n    html: update,\n  });\n\n  return true;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,WAAW;AAClB,OAAO,WAAW;AAClB,OAAO,aAAa;AACpB,OAAO,iBAAiB;AAExB,SAAsB,mBAAmB,SAAiB,KAAa;AAAA;AACrE,UAAM,QAAQ,QAAQ,KAAK,OAAO;AAClC,UAAM,UAAU,MAAM,KAAK;AAE3B,UAAM,QAAQ;AAAA,MACZ,QAAQ,IAAI,CAAO,OAAO,YAAY;AACpC,cAAM,aAAa,MAAM,OAAO;AAChC,cAAM,SAAS,WAAW,KAAK,KAAK;AAEpC,YAAI,QAAQ;AACV,cAAI;AAEF,kBAAM,WAAW,MAAM,MAAM,IAAI,QAAQ;AAAA,cACvC,cAAc;AAAA,YAChB,CAAC;AAGD,kBAAM,qBAAqB,MAAM,MAAM,SAAS,IAAI,EACjD,OAAO,EAAE,OAAO,KAAK,QAAQ,KAAK,KAAK,SAAS,CAAC,EACjD,KAAK,EAAE,SAAS,GAAG,CAAC,EACpB,SAAS;AAKZ,kBAAM,cAAc,cAAc,MAAM,SAAS,IAAI,EAAE,SAAS,EAAE,MAAM,WAAW,mBAAmB,SAAS,QAAQ,CAAC;AAGxH,uBAAW,KAAK,OAAO,WAAW;AAAA,UACpC,SAAS,OAAO;AACd,oBAAQ,MAAM,0BAA0B,MAAM,KAAK,KAAK,EAAE;AAAA,UAC5D;AAAA,QACF;AAAA,MACF,EAAC;AAAA,IACH;AACA,UAAM,SAAS,MAAM,KAAK;AAC1B,UAAM,YAAY;AAAA,MAChB,QAAQ;AAAA,MACR,MAAM;AAAA,IACR,CAAC;AAED,WAAO;AAAA,EACT;AAAA;","names":[]}